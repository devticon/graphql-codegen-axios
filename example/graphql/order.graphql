fragment Order on Order {
  id
  status
  projectId
  createdAt
  customerId
  currentPrice
  currency
  title
  webhookUrl
  price
}
fragment OrderItem on OrderItem {
  id
  createdAt
  name
  price
  details
  qty
}
fragment OrderForProcessing on Order {
  ...Order
  payments {
    ...Payment
  }
  items {
   ...OrderItem
  }
  customer {
    ...Customer
  }
}

fragment OrderForRefund on Order {
  id
  status
  canBeRefunded
}

fragment OrderWithAggregates on Order {
  ...Order
  refundedAmount
  paidAmount
}

query findOrderByProjectIdAndMerchantId($projectId: uuid! $merchantId: String!)  {
  order(where: {projectId: {_eq: $projectId} merchantId: {_eq: $merchantId}}) @first {
    ...Order
  }
}

query getOrderByProjectIdAndMerchantId($projectId: uuid! $merchantId: String!)  {
  order(where: {projectId: {_eq: $projectId} merchantId: {_eq: $merchantId}}) @firstOrFail {
    ...Order
  }
}
query getOrderById($id: uuid!) {
  orderByPk(id: $id) @nonNullable {
    ...Order
  }
}
mutation createOrder($input: OrderInsertInput!) {
  insertOrderOne(object: $input) @nonNullable {
    ...OrderForProcessing
  }
}

query getOrderByPaymentId($paymentId: uuid!) {
  order(where: {payments: {id: {_eq: $paymentId}}}) @firstOrFail {
    ...Order
  }
}
query getOrderForRefund($orderId: uuid! $projectId: uuid) {
  order(where: {id: {_eq: $orderId} projectId: {_eq: $projectId}}) @firstOrFail {
    ...OrderForRefund
  }
}
query getOrderByIdAndPartnerId($orderId: uuid! $projectId: uuid) {
  order(where: {id: {_eq: $orderId} projectId: {_eq: $projectId}}) @firstOrFail  {
    ...Order
  }
}
mutation updateOrderById($id: uuid! $input: OrderSetInput!) {
  updateOrderByPk(pk_columns: {id: $id} _set: $input) {
    ...Order
  }
}
query getOrderForProcess($id: uuid! $projectId: uuid!) {
  order(where: {id: {_eq: $id} projectId: {_eq: $projectId}}) @firstOrFail {
    ...OrderForProcessing
  }
}
query getOrderWithAggregates($id: uuid!) {
  order(where: {id: {_eq: $id}}) @firstOrFail {
    ...OrderWithAggregates
  }
}